<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>World Conquest - Mentat Party</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Arial', sans-serif;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
        overflow: hidden;
      }

      #gameContainer {
        display: flex;
        flex-direction: column;
        height: 100vh;
        padding: 20px;
      }

      #header {
        text-align: center;
        margin-bottom: 20px;
      }

      h1 {
        font-size: 36px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      }

      #gameArea {
        display: flex;
        gap: 20px;
        flex: 1;
      }

      #mapContainer {
        flex: 1;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        position: relative;
      }

      #worldMap {
        width: 100%;
        height: 100%;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        background: #2c3e50;
      }

      #sidebar {
        width: 300px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        overflow-y: auto;
      }

      .panel {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        padding: 15px;
      }

      .panel h3 {
        margin-bottom: 10px;
        color: #ffd700;
      }

      .stat {
        display: flex;
        justify-content: space-between;
        margin: 5px 0;
        padding: 5px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 4px;
      }

      button {
        padding: 10px 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 5px;
        color: white;
        font-size: 14px;
        cursor: pointer;
        transition: transform 0.2s;
        width: 100%;
        margin: 5px 0;
      }

      button:hover {
        transform: scale(1.05);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      #countryList {
        max-height: 200px;
        overflow-y: auto;
      }

      .country-item {
        padding: 8px;
        margin: 5px 0;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s;
      }

      .country-item:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .country-item.selected {
        background: rgba(102, 126, 234, 0.5);
        border: 2px solid #667eea;
      }

      #startScreen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      #startScreen h2 {
        font-size: 48px;
        margin-bottom: 30px;
      }

      #startScreen p {
        font-size: 18px;
        margin-bottom: 40px;
        text-align: center;
        max-width: 600px;
      }

      .mode-selection {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
      }

      .mode-button {
        padding: 20px 40px;
        font-size: 18px;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.3);
      }

      .mode-button.selected {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-color: #667eea;
      }

      #turnTimer {
        font-size: 24px;
        font-weight: bold;
        color: #ffd700;
        text-align: center;
        padding: 10px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .alliance-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-left: 5px;
      }
    </style>
  </head>
  <body>
    <div id="startScreen">
      <h2>üåç World Conquest üåç</h2>
      <p>
        Choose your country and conquer the world through strategy, economy, and
        diplomacy!
      </p>

      <div class="mode-selection">
        <button class="mode-button selected" onclick="selectMode('sandbox')">
          üéÆ Sandbox Mode<br />
          <small>Free play, switch countries anytime</small>
        </button>
        <button class="mode-button" onclick="selectMode('turnbyturn')">
          ‚öîÔ∏è Turn-By-Turn<br />
          <small>Strategic mode with AI & alliances</small>
        </button>
      </div>

      <button onclick="startGame()">Start Game</button>
    </div>

    <div id="gameContainer" style="display: none">
      <div id="header">
        <h1>üåç World Conquest</h1>
      </div>

      <div id="gameArea">
        <div id="mapContainer">
          <canvas id="worldMap"></canvas>
        </div>

        <div id="sidebar">
          <div id="turnTimerContainer" style="display: none">
            <div id="turnTimer">Time: 30s</div>
          </div>

          <div class="panel">
            <h3>Your Empire</h3>
            <div class="stat">
              <span>Country:</span>
              <span id="playerCountry">None</span>
            </div>
            <div class="stat">
              <span>Territories:</span>
              <span id="territoryCount">0</span>
            </div>
            <div class="stat">
              <span>üí∞ Gold:</span>
              <span id="gold">1000</span>
            </div>
            <div class="stat">
              <span>‚öîÔ∏è Army:</span>
              <span id="army">100</span>
            </div>
            <div class="stat">
              <span>üéñÔ∏è Military Level:</span>
              <span id="militaryLevel">1</span>
            </div>
            <div class="stat" id="planesDisplay" style="display: none">
              <span>‚úàÔ∏è Planes:</span>
              <span id="planes">0</span>
            </div>
          </div>

          <div class="panel">
            <h3>Actions</h3>
            <button onclick="recruitArmy()">Recruit Army (100üí∞)</button>
            <button onclick="improveMilitary()">
              Upgrade Military (300üí∞)
            </button>
            <button onclick="improveEconomy()">Improve Economy (200üí∞)</button>
          </div>

          <div class="panel" id="alliancePanel" style="display: none">
            <h3>Alliances</h3>
            <div id="allianceInfo">No alliance</div>
            <button onclick="requestAlliance()">Request Alliance</button>
          </div>

          <div class="panel">
            <h3>Select Country</h3>
            <div id="countryList"></div>
          </div>

          <div class="panel">
            <h3>Game Info</h3>
            <div class="stat">
              <span>Mode:</span>
              <span id="gameMode">Sandbox</span>
            </div>
            <div class="stat">
              <span>Turn:</span>
              <span id="turn">1</span>
            </div>
            <button onclick="nextTurn()">Next Turn</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Game state
      const gameState = {
        mode: 'sandbox', // 'sandbox' or 'turnbyturn'
        playerCountry: null,
        countries: {},
        alliances: [], // Array of alliance objects
        turn: 1,
        gold: 1000,
        army: 100,
        economyLevel: 1,
        militaryLevel: 1,
        planes: 0,
        turnTimeLeft: 30,
        turnTimerInterval: null,
        attackedCountries: [], // Track which countries player attacked
      };

      // Alliance colors
      const allianceColors = [
        '#FF6B6B',
        '#4ECDC4',
        '#45B7D1',
        '#FFA07A',
        '#98D8C8',
        '#F7DC6F',
        '#BB8FCE',
        '#85C1E2',
      ];

      // Simplified world map data
      const worldCountries = [
        {
          id: 'usa',
          name: 'United States',
          x: 150,
          y: 200,
          neighbors: ['canada', 'mexico'],
        },
        { id: 'canada', name: 'Canada', x: 150, y: 100, neighbors: ['usa'] },
        { id: 'mexico', name: 'Mexico', x: 150, y: 300, neighbors: ['usa'] },
        {
          id: 'brazil',
          name: 'Brazil',
          x: 300,
          y: 450,
          neighbors: ['argentina'],
        },
        {
          id: 'argentina',
          name: 'Argentina',
          x: 280,
          y: 550,
          neighbors: ['brazil'],
        },
        {
          id: 'uk',
          name: 'United Kingdom',
          x: 500,
          y: 150,
          neighbors: ['france', 'germany'],
        },
        {
          id: 'france',
          name: 'France',
          x: 520,
          y: 200,
          neighbors: ['uk', 'germany', 'spain', 'italy'],
        },
        {
          id: 'germany',
          name: 'Germany',
          x: 550,
          y: 180,
          neighbors: ['uk', 'france', 'poland', 'russia'],
        },
        { id: 'spain', name: 'Spain', x: 480, y: 240, neighbors: ['france'] },
        { id: 'italy', name: 'Italy', x: 560, y: 240, neighbors: ['france'] },
        {
          id: 'poland',
          name: 'Poland',
          x: 600,
          y: 170,
          neighbors: ['germany', 'russia'],
        },
        {
          id: 'russia',
          name: 'Russia',
          x: 700,
          y: 150,
          neighbors: ['germany', 'poland', 'china'],
        },
        {
          id: 'china',
          name: 'China',
          x: 800,
          y: 250,
          neighbors: ['russia', 'india', 'japan'],
        },
        { id: 'india', name: 'India', x: 750, y: 300, neighbors: ['china'] },
        { id: 'japan', name: 'Japan', x: 900, y: 230, neighbors: ['china'] },
        { id: 'australia', name: 'Australia', x: 850, y: 500, neighbors: [] },
        {
          id: 'egypt',
          name: 'Egypt',
          x: 580,
          y: 300,
          neighbors: ['southafrica'],
        },
        {
          id: 'southafrica',
          name: 'South Africa',
          x: 600,
          y: 500,
          neighbors: ['egypt'],
        },
      ];

      // Initialize countries
      worldCountries.forEach((country) => {
        gameState.countries[country.id] = {
          ...country,
          owner: null,
          army: Math.floor(Math.random() * 50) + 50,
          color: '#888',
          alliance: null,
        };
      });

      let canvas, ctx;
      let selectedMode = 'sandbox';

      function selectMode(mode) {
        selectedMode = mode;
        document.querySelectorAll('.mode-button').forEach((btn) => {
          btn.classList.remove('selected');
        });
        event.target.closest('.mode-button').classList.add('selected');
      }

      function startGame() {
        gameState.mode = selectedMode;
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('gameContainer').style.display = 'flex';
        document.getElementById('gameMode').textContent =
          selectedMode === 'sandbox' ? 'Sandbox' : 'Turn-By-Turn';

        // Show/hide mode-specific UI
        if (selectedMode === 'turnbyturn') {
          document.getElementById('turnTimerContainer').style.display = 'block';
          document.getElementById('alliancePanel').style.display = 'block';
          initializeAlliances();
          startTurnTimer();
        }

        canvas = document.getElementById('worldMap');
        ctx = canvas.getContext('2d');

        // Set canvas size
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;

        // Populate country list
        const countryList = document.getElementById('countryList');
        worldCountries.forEach((country) => {
          const div = document.createElement('div');
          div.className = 'country-item';
          div.textContent = country.name;
          div.onclick = () => selectCountry(country.id);
          div.id = `country-${country.id}`;
          countryList.appendChild(div);
        });

        drawMap();
      }

      function initializeAlliances() {
        // Create initial alliances between some countries
        const allianceGroups = [
          ['usa', 'canada', 'uk'],
          ['russia', 'china'],
          ['france', 'germany', 'italy'],
          ['brazil', 'argentina'],
        ];

        allianceGroups.forEach((group, index) => {
          const alliance = {
            id: `alliance-${index}`,
            members: group,
            color: allianceColors[index],
          };
          gameState.alliances.push(alliance);

          group.forEach((countryId) => {
            if (gameState.countries[countryId]) {
              gameState.countries[countryId].alliance = alliance.id;
            }
          });
        });
      }

      function startTurnTimer() {
        if (gameState.turnTimerInterval) {
          clearInterval(gameState.turnTimerInterval);
        }

        gameState.turnTimeLeft = 30;
        updateTimerDisplay();

        gameState.turnTimerInterval = setInterval(() => {
          gameState.turnTimeLeft--;
          updateTimerDisplay();

          if (gameState.turnTimeLeft <= 0) {
            nextTurn();
          }
        }, 1000);
      }

      function updateTimerDisplay() {
        const timerEl = document.getElementById('turnTimer');
        timerEl.textContent = `Time: ${gameState.turnTimeLeft}s`;

        if (gameState.turnTimeLeft <= 10) {
          timerEl.style.color = '#ff4444';
        } else {
          timerEl.style.color = '#ffd700';
        }
      }

      function selectCountry(countryId) {
        if (gameState.mode === 'turnbyturn' && gameState.playerCountry) {
          alert('In Turn-By-Turn mode, you cannot switch countries!');
          return;
        }

        if (gameState.playerCountry && gameState.mode === 'sandbox') {
          // Allow switching in sandbox mode
          gameState.countries[gameState.playerCountry].owner = null;
          gameState.countries[gameState.playerCountry].color = '#888';
        }

        gameState.playerCountry = countryId;
        gameState.countries[countryId].owner = 'player';
        gameState.countries[countryId].color = '#4CAF50';

        document.getElementById('playerCountry').textContent =
          gameState.countries[countryId].name;

        // Update country list
        document.querySelectorAll('.country-item').forEach((item) => {
          item.classList.remove('selected');
        });
        document
          .getElementById(`country-${countryId}`)
          .classList.add('selected');

        updateUI();
        drawMap();
      }

      function drawMap() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw connections
        ctx.strokeStyle = 'rgba(255,255,255,0.2)';
        ctx.lineWidth = 1;
        Object.values(gameState.countries).forEach((country) => {
          country.neighbors.forEach((neighborId) => {
            const neighbor = gameState.countries[neighborId];
            ctx.beginPath();
            ctx.moveTo(country.x, country.y);
            ctx.lineTo(neighbor.x, neighbor.y);
            ctx.stroke();
          });
        });

        // Draw countries
        Object.values(gameState.countries).forEach((country) => {
          // Draw circle for country
          ctx.fillStyle = country.color;
          ctx.beginPath();
          ctx.arc(country.x, country.y, 20, 0, Math.PI * 2);
          ctx.fill();

          // Draw border (alliance or player)
          if (country.alliance && gameState.mode === 'turnbyturn') {
            const alliance = gameState.alliances.find(
              (a) => a.id === country.alliance
            );
            ctx.strokeStyle = alliance
              ? alliance.color
              : 'rgba(255,255,255,0.5)';
            ctx.lineWidth = 4;
          } else {
            ctx.strokeStyle =
              country.owner === 'player' ? '#FFD700' : 'rgba(255,255,255,0.5)';
            ctx.lineWidth = country.owner === 'player' ? 3 : 1;
          }
          ctx.stroke();

          // Draw name
          ctx.fillStyle = 'white';
          ctx.font = '12px Arial';
          ctx.textAlign = 'center';
          ctx.fillText(country.name, country.x, country.y + 35);

          // Draw army count
          ctx.fillText(`‚öîÔ∏è${country.army}`, country.x, country.y);
        });
      }

      function updateUI() {
        const playerTerritories = Object.values(gameState.countries).filter(
          (c) => c.owner === 'player'
        ).length;
        document.getElementById('territoryCount').textContent =
          playerTerritories;
        document.getElementById('gold').textContent = gameState.gold;
        document.getElementById('army').textContent = gameState.army;
        document.getElementById('turn').textContent = gameState.turn;
        document.getElementById('militaryLevel').textContent =
          gameState.militaryLevel;

        // Update planes display
        if (gameState.militaryLevel >= 5) {
          document.getElementById('planesDisplay').style.display = 'flex';
          document.getElementById('planes').textContent = gameState.planes;
        }

        // Update alliance info
        if (gameState.mode === 'turnbyturn' && gameState.playerCountry) {
          const playerCountryData =
            gameState.countries[gameState.playerCountry];
          const allianceInfo = document.getElementById('allianceInfo');

          if (playerCountryData.alliance) {
            const alliance = gameState.alliances.find(
              (a) => a.id === playerCountryData.alliance
            );
            allianceInfo.innerHTML = `Alliance: ${alliance.members
              .map((id) => gameState.countries[id].name)
              .join(', ')}`;
          } else {
            allianceInfo.textContent = 'No alliance';
          }
        }
      }

      function recruitArmy() {
        if (gameState.gold >= 100) {
          gameState.gold -= 100;
          gameState.army += 50;
          updateUI();
        } else {
          alert('Not enough gold!');
        }
      }

      function improveMilitary() {
        if (gameState.gold >= 300) {
          gameState.gold -= 300;
          gameState.militaryLevel++;

          // Unlock planes at level 5
          if (gameState.militaryLevel >= 5) {
            gameState.planes += 10;
            alert(
              'Military upgraded! Planes unlocked - you can now attack overseas!'
            );
          } else {
            alert('Military upgraded! Army is now stronger.');
          }

          updateUI();
        } else {
          alert('Not enough gold!');
        }
      }

      function improveEconomy() {
        if (gameState.gold >= 200) {
          gameState.gold -= 200;
          gameState.economyLevel++;
          alert('Economy improved! You will earn more gold per turn.');
          updateUI();
        } else {
          alert('Not enough gold!');
        }
      }

      function requestAlliance() {
        if (!gameState.playerCountry) {
          alert('Select a country first!');
          return;
        }

        const playerCountryData = gameState.countries[gameState.playerCountry];

        if (playerCountryData.alliance) {
          alert('You are already in an alliance!');
          return;
        }

        // Find alliances that player hasn't attacked
        const availableAlliances = gameState.alliances.filter((alliance) => {
          return !alliance.members.some((memberId) =>
            gameState.attackedCountries.includes(memberId)
          );
        });

        if (availableAlliances.length === 0) {
          alert(
            'No alliances available - you have attacked members of all existing alliances!'
          );
          return;
        }

        // Join first available alliance
        const alliance = availableAlliances[0];
        alliance.members.push(gameState.playerCountry);
        playerCountryData.alliance = alliance.id;

        alert(
          `Joined alliance with: ${alliance.members
            .map((id) => gameState.countries[id].name)
            .join(', ')}`
        );

        updateUI();
        drawMap();
      }

      function performAIActions() {
        if (gameState.mode !== 'turnbyturn') return;

        // AI countries occasionally attack each other
        const aiCountries = Object.values(gameState.countries).filter(
          (c) => c.owner !== 'player' && c.owner !== null
        );

        if (Math.random() < 0.3 && aiCountries.length > 1) {
          const attacker =
            aiCountries[Math.floor(Math.random() * aiCountries.length)];
          const possibleTargets = attacker.neighbors
            .map((id) => gameState.countries[id])
            .filter((c) => c.owner !== attacker.owner);

          if (possibleTargets.length > 0) {
            const target =
              possibleTargets[
                Math.floor(Math.random() * possibleTargets.length)
              ];

            // Check alliance
            if (attacker.alliance && attacker.alliance === target.alliance) {
              return; // Don't attack alliance members
            }

            if (attacker.army > target.army) {
              target.owner = attacker.owner;
              target.color = attacker.color;
              console.log(`${attacker.name} conquered ${target.name}!`);
            }
          }
        }
      }

      function nextTurn() {
        gameState.turn++;

        // Generate income
        const playerTerritories = Object.values(gameState.countries).filter(
          (c) => c.owner === 'player'
        ).length;
        const income = playerTerritories * 50 * gameState.economyLevel;
        gameState.gold += income;

        // AI moves
        Object.values(gameState.countries).forEach((country) => {
          if (country.owner !== 'player' && country.owner !== null) {
            country.army += Math.floor(Math.random() * 10);
          }
        });

        // Perform AI actions in turn-by-turn mode
        if (gameState.mode === 'turnbyturn') {
          performAIActions();
          startTurnTimer();
        }

        updateUI();
        drawMap();
        alert(`Turn ${gameState.turn}\nIncome: +${income}üí∞`);
      }

      // Canvas click handler for conquering
      document.getElementById('worldMap').addEventListener('click', (e) => {
        if (!gameState.playerCountry) {
          alert('Please select your starting country first!');
          return;
        }

        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        // Find clicked country
        Object.values(gameState.countries).forEach((country) => {
          const distance = Math.sqrt(
            (x - country.x) ** 2 + (y - country.y) ** 2
          );
          if (distance < 20) {
            attemptConquest(country.id);
          }
        });
      });

      function attemptConquest(targetId) {
        const target = gameState.countries[targetId];

        if (target.owner === 'player') {
          alert('You already own this territory!');
          return;
        }

        // Check if target is neighbor of player territory
        const playerTerritories = Object.values(gameState.countries).filter(
          (c) => c.owner === 'player'
        );
        const isNeighbor = playerTerritories.some((territory) =>
          territory.neighbors.includes(targetId)
        );

        // Check if player has planes for overseas attack
        const canAttackOverseas =
          gameState.planes > 0 && gameState.militaryLevel >= 5;

        if (!isNeighbor && !canAttackOverseas) {
          alert(
            'You can only attack neighboring territories! Upgrade military to level 5 for planes.'
          );
          return;
        }

        if (!isNeighbor && canAttackOverseas) {
          gameState.planes -= 1; // Use a plane for overseas attack
          alert('Using plane for overseas attack!');
        }

        // Check alliance
        if (gameState.mode === 'turnbyturn' && target.alliance) {
          const playerCountryData =
            gameState.countries[gameState.playerCountry];

          if (target.alliance === playerCountryData.alliance) {
            alert('You cannot attack your alliance members!');
            return;
          }

          // Track attacked country
          if (!gameState.attackedCountries.includes(targetId)) {
            gameState.attackedCountries.push(targetId);
          }

          // Alliance retaliation
          const alliance = gameState.alliances.find(
            (a) => a.id === target.alliance
          );
          if (alliance) {
            alert(
              `Warning: You attacked ${target.name}, part of an alliance! They may retaliate.`
            );

            // Alliance members attack back
            alliance.members.forEach((memberId) => {
              const member = gameState.countries[memberId];
              if (member.owner !== 'player' && Math.random() < 0.5) {
                member.army += 20; // Boost their army
              }
            });
          }
        }

        // Battle
        const attackPower =
          gameState.army * (1 + gameState.militaryLevel * 0.1);
        if (attackPower > target.army) {
          const casualties = Math.floor(target.army * 0.7);
          gameState.army -= casualties;
          target.owner = 'player';
          target.color = '#4CAF50';
          target.army = Math.floor(gameState.army * 0.5);
          alert(
            `Victory! You conquered ${target.name}!\nCasualties: ${casualties}`
          );
        } else {
          const casualties = Math.floor(gameState.army * 0.3);
          gameState.army -= casualties;
          alert(
            `Defeat! ${target.name} has a stronger army.\nCasualties: ${casualties}`
          );
        }

        updateUI();
        drawMap();
      }

      // Resize canvas on window resize
      window.addEventListener('resize', () => {
        if (canvas) {
          canvas.width = canvas.offsetWidth;
          canvas.height = canvas.offsetHeight;
          drawMap();
        }
      });
    </script>
  </body>
</html>
